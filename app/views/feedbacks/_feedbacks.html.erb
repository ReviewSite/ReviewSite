<table class="feedback">
  <thead>
  <tr>
    <th class="reviewer-name-col">Reviewer</th>
    <th class="reviewer-name-col">Project worked on</th>
    <th class="review-date-col">Date Updated</th>
    <th class="review-date-col">Invitation Sent</th>
    <th class="boolean-col">Status</th>
    <th class="action-col"></th>
  </tr>
  </thead>
  <tbody>
  <% feedbacks.includes(:user, :review).each do |feedback| %>
    <tr>
      <td><%= feedback.reviewer %></td>
      <td><%= feedback.project_worked_on %></td>
      <td><%= feedback.updated_at.to_date %></td>
      <td>
      <% if feedback.invitation %>
        <%= feedback.invitation.sent_date %>
      <% end %>
      </td>

      <td class="nowrap">
        <% if feedback.submitted %>
            Submitted
        <% else %>
            Not Submitted
        <% end %>
      </td>
      <td class="nowrap button-col">
        <ul>
          <% if (not feedback.submitted?) and (not feedback.is_additional) %>
            <li> <%= link_to 'Send Reminder',
                send_reminder_review_feedback_path(feedback.review, feedback),
                data: {confirm: "This will send an email to #{feedback.user.email}.\nAre you sure you want to?"}, method: :post, class: "button link" %></li>
          <% end %>
          <%  if can? :submit, feedback %>
            <li> <%= link_to 'Submit', submit_review_feedback_path(feedback.review, feedback), method: :put, class: "button link" %></li>
              <% elsif can? :unsubmit, feedback %>
            <li> <%= link_to 'Unsubmit', unsubmit_review_feedback_path(feedback.review, feedback), method: :put, class: "button link"  %></li>
          <% end %>
          <% if can? :edit, feedback %>
            <li> <%= link_to 'Edit', edit_review_feedback_path(feedback.review, feedback), id:"feedback_#{feedback.id}_edit", class: "button link" %></li>
          <% end %>
          <% if can? :show, feedback %>
            <li><%= link_to 'Show', [feedback.review, feedback], class: "button link" %></li>
          <% end %>
        </ul>
      </td>
    </tr>
  <% end %>

  <% invitations.includes(:review).each do |invitation| %>
    <% if invitation.feedback.nil? %>
    <tr>
      <td><%= invitation.email %></td>
      <td></td>
      <td></td>
      <td><%= invitation.sent_date %></td>
      <td class="nowrap">Not Started</td>
      <td class="nowrap button-col">
        <ul>
          <li><%= link_to 'Send Reminder',
                  send_reminder_review_invitation_path(invitation.review, invitation),
                  data: {confirm: "This will send an email to #{invitation.email}.\nAre you sure you want to?"},
                  method: :post, class: "button link" %>
          </li>
          <li><%= link_to 'Delete Invitation',
                  review_invitation_path(invitation.review, invitation),
                  data: {confirm: "Are you sure you want to delete your invitation to #{invitation.email}?"},
                  method: :delete, class: "button link" %>
          </li>
        </ul>
      </td>
    </tr>
    <% end %>
  <% end %>

  </tbody>
</table>

<br class="spacer" />

<script>
  $('.feedback').dataTable({
    aoColumnDefs: [
      { bSortable: false, aTargets: [5] }
    ],
    bPaginate: false,
    bLengthChange: false,
    bFilter: false,
    bInfo: false,
    bRetrieve: true,
    bDestroy: true
    });
</script>
